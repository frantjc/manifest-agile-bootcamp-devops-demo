pipeline {
  agent any

  stages {
    stage('Build') {
      steps {
      	sh './mvnw -U install'
      }
    }

    stage('Test') {
      steps {
        sh './mvnw test'
      }
    }

    stage('Code Analysis'){
      steps {
        sh './mvnw jacoco:report'
        sh './mvnw jacoco:check'
      }	
    }

    stage('Nexus Archive') {
      steps {
        sh './mvnw deploy'
      }
    }
  }

  post {
    always {
      echo 'DONE'
      junit testResults: 'target/surefire-reports/TEST-com.manifestcorp.demo.DemoApplicationTests.xml'
    }

    success {
      echo 'SUCCESS'
    }

    failure {
      echo 'FAILURE'
      mail body: '<b>Job Failed</b>',
        from: '',
        mimeType: 'text/html',
        replyTo: '',
        subject: "JOB FAILURE: ${env.JOB_NAME} - #${env.BUILD_NUMBER}", 
        to: 'logsdonalex11@gmail.com';   
    }
  }
}
